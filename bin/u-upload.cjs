#!/usr/bin/env node
"use strict";const i=require("commander"),a=require("net"),p=require("@xiaou66/interconnect-client"),d="1.0.0",m="用于命令行上传图片到uTools图床Plus插件的工具",u={version:d,description:m},{ServiceClient:g}=p;async function f(r,s){const{uploadId:t,timeout:n=15e3}=s;try{const e=await new g(a,"picture-bed-plus","command",!1).callServiceMethod("service.upload.file.sync",{filePath:r,uploadWay:t},{timeout:n});return{url:(e==null?void 0:e.url)||"",success:!!(e!=null&&e.url)}}catch(o){return{url:"",success:!1,error:o instanceof Error?o.message:String(o)}}}async function v(r,s){const t=[];for(const n of r){const o=await f(n,s);t.push(o)}return t}i.program.version(u.version).description(u.description);i.program.arguments("<imagePaths...>").description("图片地址，可传多个").option("-u, --uploadId <uploadId>","图床源,需要和「utools」图床Plus 填写存储源id").option("-t, --timeout <timeout>","上传超时时间（毫秒），默认15000","15000").action(async(r,{uploadId:s,timeout:t},n)=>{s||(console.error("错误：必须提供 uploadId 参数"),process.exit(1)),console.log(`开始上传 ${r.length} 个文件到图床...`);try{const o=await v(r,{uploadId:s,timeout:parseInt(t,10)});let e=0;o.forEach((c,l)=>{c.success?(console.log(`${r[l]}: ${c.url}`),e++):console.error(`${r[l]}: 上传失败 - ${c.error}`)}),console.log(`上传完成，成功: ${e}/${r.length}`),process.exit(e>0?0:1)}catch(o){console.error("上传过程出现错误:",o instanceof Error?o.message:String(o)),process.exit(1)}});i.program.parse();
